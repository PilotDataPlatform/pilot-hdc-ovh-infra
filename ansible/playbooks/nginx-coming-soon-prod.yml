---
# TEMPORARY: Static coming soon page for prod
# Remove this playbook once prod K8s cluster is ready
- name: Setup temporary coming soon page (prod only)
  hosts: nginx-prod
  become: true
  vars_files:
    - ../vars/sensitive.yml
  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Create coming soon HTML
      copy:
        dest: /var/www/html/index.html
        content: |
          <!DOCTYPE html>
          <html>
          <head>
              <title>HDC - Coming Soon</title>
              <style>
                  body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #f5f5f5; }
                  .container { text-align: center; }
                  h1 { color: #333; }
                  p { color: #666; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>HDC - Coming Soon</h1>
                  <p>We're working on something new. Stay tuned!</p>
              </div>
          </body>
          </html>
        mode: '0644'

    - name: Configure nginx to serve static content
      copy:
        # TEMPORARY: Replace with reverse proxy config when prod K8s is ready
        dest: /etc/nginx/sites-available/default
        content: |
          # TEMPORARY - Remove when prod K8s cluster is deployed
          server {
              listen 80 default_server;
              listen [::]:80 default_server;
              server_name hdc.ebrains.eu *.hdc.ebrains.eu;

              root /var/www/html;
              index index.html;

              location / {
                  try_files $uri $uri/ =404;
              }
          }
        mode: '0644'
      notify: Reload nginx

  handlers:
    - name: Reload nginx
      service:
        name: nginx
        state: reloaded
